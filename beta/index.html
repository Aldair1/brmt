<!doctype html>
<html>

<head>
	<title>gen7 brmt</title>
	<base target="_blank">
	<script src="./tools.js"></script>
	<script src="./build.js"></script>
	<script src="./OUcc.js"></script>
	<link  href="./brmt.css" rel="stylesheet">
</head>

<body>
	<label for="builddata">Build data</label> <button id="build">rebuild compendium</button> <button id="useofficialnames">use official names</button> <button id="usespeciesid">use species ID</button><br>
	<textarea id="builddata"></textarea><br>
	<div id="output"></div>
	<div ID="onclickinfo_popout" class="infopopout" onmouseleave="this.style.display = 'none'"></div>
	<script>
		let buildDataToString = (data, sep, linesep, useOfficialNames) => data.map( arr => arr.map( a => packBuildData(unpackBuildData([a]), useOfficialNames) ).join(sep) ).join(linesep);
		window.onload = function() {
			let taBuilddata = document.getElementById("builddata");
			let btnBuild = document.getElementById("build");
			let output = document.getElementById("output");
			
			document.getElementById("useofficialnames").addEventListener('click', function() {
				taBuilddata.value = buildDataToString( taBuilddata.value.split(/\r?\n/g).map( line => line.split(",").map(trim) ), ", ", "\n", true );
			});
			document.getElementById("usespeciesid").addEventListener('click', function() {
				taBuilddata.value = buildDataToString( taBuilddata.value.split(/\r?\n/g).map( line => line.split(",").map(trim) ), ", ", "\n" );
			});
			
			if (!location.hash) location.hash = buildDataToString( window.compendiums.OUcc.buildData, ",", "&" );
			else if (location.hash === "#gen7OUcc") location.hash = buildDataToString( gen7OUccBuilddata, ",", "&" );
			taBuilddata.value = location.hash.substr(1).replace(/&/g, "\n").replace(/,/g, ", ").replace(/%20/g, " ");
			
			btnBuild.addEventListener('click', function() {
				let buildData = taBuilddata.value.split(/\r?\n/g).map( line => line.split(",").map(trim) );
				
				window.compendiums.OUcc = {
					"buildData": buildData
				};
				
				let compendium = window.buildTools.buildChecksCompendium( buildData );
				window.build = compendium.build;
				window.compendiums.OUcc.miniIcons = compendium.miniIcons;
				
				location.hash = buildDataToString( buildData, ",", "&" );
				output.innerHTML = window.buildTools.compendiumToHtmlImages( window.compendiums.OUcc, build, ["tiles"] );
				addIconWrapListeners( output, 'click', addPopup );
			});
			btnBuild.click();
		}
		
		window.onerror = function(msg, url, line, col, error) {
			// Note that col & error are new to the HTML 5 spec and may not be 
			// supported in every browser
			var extra = !col ? '' : '\ncolumn: ' + col;
			extra += !error ? '' : '\nerror: ' + error;
			
			// You can view the information in an alert to see things working like this:
			alert("Error: " + msg + "\nurl: " + url + "\nline: " + line + extra);
			
			// TODO: Report this error via ajax so you can keep track
			//       of what pages have JS issues
			
			var suppressErrorAlert = false;
			// If you return true, then error alerts (like in older versions of 
			// Internet Explorer) will be suppressed.
			return suppressErrorAlert;
		};
	</script>
</body>

</html>
