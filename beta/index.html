<!doctype html>
<html>

<head>
	<title>gen7 brmt</title>
	<base target="_blank">
	<script src="./tools.js"></script>
	<script src="./build.js"></script>
	<script src="./OUcc.js"></script>
	<link  href="./brmt.css" rel="stylesheet">
</head>

<body>
	<label for="builddata">Build data</label> <button id="build">rebuild compendium</button><br>
	<textarea id="builddata"></textarea><br>
	<div id="output"></div>
	<div class="footer">
		<details> <textarea id="miniicons"></textarea> <summary>Mini Icons</summary> </details>
		<details> <textarea id="aliases"></textarea> <summary>Aliases</summary> </details>
		<details> <textarea id="changelog">maybe coming soon</textarea> <summary>Changelog</summary> </details>
	</div>
	<div ID="onclickinfo_popout" class="infopopout" onmouseleave="this.style.display = 'none'"></div>
	<script>
		window.onload = function() {
			let btnBuild = document.getElementById("build");
			let [taBuilddata, taMiniicons, taAliases, taChangelog] = ["builddata", "miniicons", "aliases", "changelog"].map(document.getElementById.bind(document));
			let output = document.getElementById("output");
			
			if (!location.hash) location.hash = window.compendiums.OUcc.buildData.map( arr => arr.join(",") ).join("&");
			taBuilddata.value = location.hash.substr(1).replace(/&/g, "\n").replace(/,/g, ", ").replace(/%20/g, " ");
			[taMiniicons, taAliases, taChangelog].forEach(
				(ta, index) =>  { ta.value = JSON.stringify(window.compendiums.OUcc[["miniIcons", "aliases", "changelog"][index]], null, 4); }
			);
			
			btnBuild.addEventListener('click', function() {
				let buildData = taBuilddata.value.split(/\r?\n/g).map( line => line.split(",").map(trim) );
				let [miniIcons, aliases, changelog] = [taMiniicons, taAliases, taChangelog].map( ta => JSON.parse(ta.value) );
				
				window.compendiums.OUcc = {
					"miniIcons": miniIcons,
					"aliases":   aliases,
					"changelog": changelog,
					"buildData": buildData
				};
				
				window.build = window.buildTools.buildChecksCompendium( buildData );
				
				location.hash = buildData.map( arr => arr.join(",") ).join("&");
				output.innerHTML = window.buildTools.compendiumToHtmlImages( window.compendiums.OUcc, build, ["tiles"] );
				addIconWrapListeners( output, 'click', addPopup );
			});
			btnBuild.click();
		}
	</script>
</body>

</html>
